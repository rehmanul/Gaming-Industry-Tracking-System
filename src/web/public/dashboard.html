<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Industry Tracker - Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .metric { text-align: center; padding: 1rem; }
        .metric-value { font-size: 2.5rem; font-weight: bold; color: #667eea; }
        .metric-label { color: #666; margin-top: 0.5rem; }
        .chart-container { position: relative; height: 300px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-healthy { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-error { background: #ef4444; }
        .insights { background: #f8fafc; border-left: 4px solid #667eea; padding: 1rem; margin: 1rem 0; }
        .btn { background: #667eea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; }
        .btn:hover { background: #5a67d8; }
        .alert { padding: 0.75rem; margin: 0.5rem 0; border-radius: 6px; }
        .alert-critical { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }
        .alert-warning { background: #fef3c7; border: 1px solid #fde68a; color: #92400e; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üéÆ Gaming Industry Analytics Dashboard</h1>
            <p>Real-time insights and performance metrics</p>
        </div>
    </div>

    <div class="container">
        <!-- Key Metrics -->
        <div class="grid">
            <div class="card">
                <div class="metric">
                    <div class="metric-value" id="totalJobs">-</div>
                    <div class="metric-label">Total Jobs Tracked</div>
                </div>
            </div>
            <div class="card">
                <div class="metric">
                    <div class="metric-value" id="newHires">-</div>
                    <div class="metric-label">New Hires Found</div>
                </div>
            </div>
            <div class="card">
                <div class="metric">
                    <div class="metric-value" id="successRate">-</div>
                    <div class="metric-label">Success Rate</div>
                </div>
            </div>
            <div class="card">
                <div class="metric">
                    <div class="metric-value" id="systemStatus">
                        <span class="status-indicator status-healthy"></span>Healthy
                    </div>
                    <div class="metric-label">System Status</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid">
            <div class="card">
                <h3>Job Posting Trends</h3>
                <div class="chart-container">
                    <canvas id="jobTrendsChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h3>Top Hiring Companies</h3>
                <div class="chart-container">
                    <canvas id="companiesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Insights & Alerts -->
        <div class="grid">
            <div class="card">
                <h3>üß† AI Insights</h3>
                <div id="insights">
                    <div class="insights">
                        <strong>Market Activity:</strong> High hiring activity detected in gaming sector
                    </div>
                    <div class="insights">
                        <strong>Hot Skills:</strong> Unity, Unreal Engine, C# are in high demand
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>üö® System Alerts</h3>
                <div id="alerts">
                    <div class="alert alert-warning">
                        API rate limit approaching - 85% used
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="card">
            <h3>Quick Actions</h3>
            <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
            <button class="btn" onclick="exportReport()">üìä Export Report</button>
            <button class="btn" onclick="runHealthCheck()">üè• Health Check</button>
        </div>
    </div>

    <script>
        const API_KEY = 'gaming-tracker-secure-key-2024';
        
        // Initialize charts
        let jobTrendsChart, companiesChart;
        
        function initCharts() {
            // Job Trends Chart
            const jobCtx = document.getElementById('jobTrendsChart').getContext('2d');
            jobTrendsChart = new Chart(jobCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'New Jobs',
                        data: [12, 19, 15, 25, 22, 18, 24],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Companies Chart
            const compCtx = document.getElementById('companiesChart').getContext('2d');
            companiesChart = new Chart(compCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Bet365', 'Evolution', 'Playtech', 'Others'],
                    datasets: [{
                        data: [30, 25, 20, 25],
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5f7fa']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/analytics/dashboard', {
                    headers: { 'X-API-Key': API_KEY }
                });
                
                if (!response.ok) throw new Error('Failed to load dashboard data');
                
                const data = await response.json();
                updateMetrics(data.metrics);
                updateCharts(data.charts);
                updateInsights(data.insights);
                updateAlerts(data.alerts);
                
            } catch (error) {
                console.error('Dashboard load error:', error);
                showError('Failed to load dashboard data');
            }
        }

        function updateMetrics(metrics) {
            document.getElementById('totalJobs').textContent = metrics.totalJobs || 0;
            document.getElementById('newHires').textContent = metrics.newHires || 0;
            document.getElementById('successRate').textContent = (metrics.successRate || 0) + '%';
            
            const statusEl = document.getElementById('systemStatus');
            const indicator = statusEl.querySelector('.status-indicator');
            
            if (metrics.systemHealth === 'healthy') {
                indicator.className = 'status-indicator status-healthy';
                statusEl.innerHTML = '<span class="status-indicator status-healthy"></span>Healthy';
            } else if (metrics.systemHealth === 'warning') {
                indicator.className = 'status-indicator status-warning';
                statusEl.innerHTML = '<span class="status-indicator status-warning"></span>Warning';
            } else {
                indicator.className = 'status-indicator status-error';
                statusEl.innerHTML = '<span class="status-indicator status-error"></span>Error';
            }
        }

        function updateCharts(chartData) {
            if (chartData.jobTrends) {
                jobTrendsChart.data.datasets[0].data = chartData.jobTrends;
                jobTrendsChart.update();
            }
            
            if (chartData.companies) {
                companiesChart.data.datasets[0].data = chartData.companies.values;
                companiesChart.data.labels = chartData.companies.labels;
                companiesChart.update();
            }
        }

        function updateInsights(insights) {
            const container = document.getElementById('insights');
            container.innerHTML = '';
            
            insights.forEach(insight => {
                const div = document.createElement('div');
                div.className = 'insights';
                div.innerHTML = `<strong>${insight.title}:</strong> ${insight.description}`;
                container.appendChild(div);
            });
        }

        function updateAlerts(alerts) {
            const container = document.getElementById('alerts');
            container.innerHTML = '';
            
            alerts.forEach(alert => {
                const div = document.createElement('div');
                div.className = `alert alert-${alert.severity}`;
                div.textContent = alert.message;
                container.appendChild(div);
            });
        }

        async function refreshData() {
            await loadDashboardData();
        }

        async function exportReport() {
            try {
                const response = await fetch('/api/analytics/export', {
                    headers: { 'X-API-Key': API_KEY }
                });
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `gaming-tracker-report-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                
            } catch (error) {
                showError('Export failed');
            }
        }

        async function runHealthCheck() {
            try {
                const response = await fetch('/api/health/detailed', {
                    headers: { 'X-API-Key': API_KEY }
                });
                
                const health = await response.json();
                alert(`Health Check Results:\n${JSON.stringify(health, null, 2)}`);
                
            } catch (error) {
                showError('Health check failed');
            }
        }

        function showError(message) {
            const alertsContainer = document.getElementById('alerts');
            const div = document.createElement('div');
            div.className = 'alert alert-critical';
            div.textContent = message;
            alertsContainer.insertBefore(div, alertsContainer.firstChild);
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            loadDashboardData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
        });
    </script>
</body>
</html>